@using UniPass.Domain
@using UniPass.Client.Services.Api
@inject FolderService FolderService

@if (_folders is null)
{
    <ProgressBar/>
}
else if (_folders is not null)
{
    @foreach (var folder in _folders)
    {
        <RadzenPanelMenuItem Icon="folder_open" IconColor="@Colors.Secondary" Text="@(folder?.Name ?? "folder")" Click="@(() => _selectedFolder = folder)" Path="@GetPath(folder)">
            @if (folder?.Keys is not null)
            {
                @foreach (var key in folder.Keys)
                {
                    <RadzenPanelMenuItem Icon="vpn_key" IconColor="@Colors.Secondary" Text="@key.Name" Path="@GetPath(key)"/>
                }
            }
        </RadzenPanelMenuItem>
    }
}


@code{
    private List<Folder> _folders = null;
    private Key _selectedKey = null;
    private Folder _selectedFolder = null;

    protected override async Task OnInitializedAsync()
    {
        var result = await FolderService.GetAllFolders();
        if (result.Success)
        {
            _folders = result.Value;
        }
    }

    private string GetPath(Folder folder)
    {
        return $"/?FolderId={folder?.Id}&KeyId={_selectedKey?.Id}";
    }

    private string GetPath(Key key)
    {
        _selectedKey = key;
        return $"/?FolderId={_selectedFolder?.Id}&KeyId={key?.Id}";
    }

}